<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BCFerryCoder Blogs</title>
    <meta name="description" content="">
    <meta name="author" content="Name Lastname">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script
src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link
href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css"
rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1"
rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72"
href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114"
href="images/apple-touch-icon-114x114.png">
  -->
<link rel="stylesheet" href="styles/default.css">
<link rel="stylesheet"
      href="/assets/highlight.js-master/src/styles/zenburn.css">

<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  <style>

     a:link.plainlink {color:black;}
     a:visited.plainlink {color:black;}
     a:hover.plainlink {color:#007040;}
     a:active {color:#00ffff;}

     .imagebutton {
       pad-top: 100px;
       margin-left: 18px;
     }

    .differentiator {
      font-size: 15px;
    }

  </style>

  </head>

  <body>

    <div style="margin-top:30px;" class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">BCFerryCoder</a>
          <ul class="nav">
      <li><a href="/topics/stackato/">Stackato/PaaS</a></li>
      <li><a href="/topics/java/">Java</a></li>
      <li><a href="/topics/tools/">Tools</a></li>
      <li><a href="/topics/enterprise/">Enterprise Software</a></li>
      <li><a href="/topics/untools/">Untools</a></li>
      <li><a href="/topics/blog/">Blog</a></li>
      <li><a href="#"></a></li>
      <li><a href="#"></a></li>
<!--<li style="line-height:5px;"><img style="position:absolute;top:20px;padding-top:5px;margin-bottom:0px;padding-bottom:0px;" src="/assets/images/dingy.png" width="115"></li>-->
<li style="line-height:5px;"><img style="position:absolute;top:4px;padding-top:5px;margin-bottom:0px;padding-bottom:0px;" src="/assets/images/bcferrycoder_nobg.png" width="185"></li>
          </ul>
        </div>
      </div>
    </div>

<div class="container">
  <div class="content">
    <div style="width:104%;margin-left:-19px;margin-top:-21px;" class="box" style="background-color:black;color:white;">
      <img width="110%" src="/assets/images/thinocean.png">
    </div>


    <div class="container">

      <div class="content">
        <div class="page-header">

  <h1>Java7 Comes to Stackato <small>On the Road with PaaS</small></h1>
</div>

<div class="row">
  <div class="span8">

    <pre>
DO NOT PUBLISH until:

  1. Brent signs off
  2. 2.6 prime is released
1</pre>
<h3 id='introduction'>Introduction</h3>

<p>Stackato has always supported Java, but had From the very beginning Java was a core language supported has been a Stackato has had a very strong affinity with Java: out of the box most Java applications can be successfully pushed to a Stackato cluster with no modification.</p>

<p>But without <a href='&quot;http://buildpacks-blog.activestate.com&quot;'>buildpacks</a> the choice of Java runtimes has thus far been limited to exactly one: Java 6 (nee jdk1.6) which until recently was the most widely used Java release, and certainly the best choice. But last week Java 6 turned the healthy age of six which, I hate to say it, seems <strong>old</strong>.</p>

<p>Oracle released Java SE 7 (codename Dolphin) July 2011, mere months after it assimilated Sun. While the initial reception to Java 7 didn&#8217;t seem as enthusiastic it was for as previous releases, adoption is now rapidly gaining momentum. In fact, according to <a href='http://blog.jelastic.com/2012/12/06/software-stacks-market-share-november-2012/'>jelastic</a>, Java7 is now the number one choice of Java version on their stack (not a terribly meaningful sample size, but probably it&#8217;s an indicator).</p>

<p>So the time is ripe for Stackato and Java 7 to join forces, and as of this week they have done so: the latest Stackato release (???) now includes Java 7 in its list of core runtimes, easily selectable at when an application is deployed.</p>

<p>Here we&#8217;ll look at some of the additional features provided by Java 7, and step through deploying a small Java Web application to Stackato, to both of the supported runtimes.</p>

<h3 id='java_7_a_rocky_start'>Java 7: A Rocky Start</h3>

<p>Shortly after the first release of Java 7 a number of serious bugs surfaced that resulted in such undesirable outcomes as file corruption, major performance hits, and &#8220;incorrect&#8221; loop execution. Scathing articles warned (using words like &#8220;dangerous&#8221; and &#8220;frightening&#8221;) to stay away from Java 7 until its shortcomings were fixed, or to quote one indignant blogger, don&#8217;t use Java 7 for anything unless you know you don&#8217;t have any loops in your java code&#8221;</p>

<p>Furthermore Oracle significantly reduced the scope of this release which had originally called for innovative features like closures, native XML support, collection literals. Sadly none of these (and quite a few others) made the cut: instead they&#8217;re being pushed to Java 8.</p>

<h3 id='so_what_did_make_it_in'>So What Did Make it In?</h3>

<p>As with every major Java release to date, Java 7 claims considerable improvements in performance and security. These alone may be enough to encourage the move to Java7. (We&#8217;ll see about performance shortly).</p>

<p>Java 7 also introduces a handful of language enhancements, mostly syntactic sugar, but something Java could use more of as they help help improve the expressiveness, conciseness, readability, and maintainability of Java. These are a subset of JSR XXX, known as &#8220;Project Coin,&#8221; and include:</p>

<ul>
<li>The switch statement now allows strings</li>

<li>Binary literals are supported</li>

<li>Multiple exceptions can be caught in one statement</li>

<li>Rudimentary type inference is now supported by the so-called &#8220;diamond&#8221; operator</li>
</ul>

<p>There are some new and improved features too:</p>

<ul>
<li>a new File I/O API with better and faster handling of directories and concurrency</li>

<li>a revamped garbage collector with higher throughput</li>

<li>initial work on modularizing the increasingly bloated Java release</li>

<li>enhancements to the JVM to better support dynamic languages</li>

<li>a new fork/join concurrency framework for hardware parallelism</li>
</ul>

<h3 id='why_upgrade'>Why Upgrade?</h3>

<p>At first I was underwhelmed by the new features of this release (and I admit I was/am still lamenting the exclusion of closures). If the new features (file, fork/join, etc.) aren&#8217;t specifically needed, is it really worth an upgrade just for the minimal language enhancements?</p>

<p>But that&#8217;s not taking performance into account. If performance is a concern (isn&#8217;t it always?), it&#8217;s certainly worthwhile considering and evaluating an upgrade.</p>

<p>So let&#8217;s do exactly that: here I&#8217;ll use Stackato to deploy a rudimentary benchmark to two application instances, one running Java 6, the other running Java 7.</p>

<p>Before looking at the application code itself, I&#8217;ll list the additional steps (actually just one single step) to choose that an application use Java 7 instead of Java 6.</p>

<h3 id='the_deployment_descriptor__manifest'>The Deployment Descriptor / Manifest</h3>

<p>Stackato is good at deducing the runtime and framework required for a given application, but we recommend including a manifest file (stackato.yml) with each app to fully specify its characteristics and requirements.</p>

<p>For our simple benchmark application, which I&#8217;ll build as a Java Web app, the &#8220;stackato.yml&#8221; file looks like this:</p>

<pre><code>name:   benchmark-java
framework:
    type: java_web
mem: 1024M</code></pre>

<p>No Java version is mentioned, so the default Java 6 is used.</p>

<p>To use Java 7, add a single line runtime directive:</p>

<pre><code>name:   benchmark-java7
framework:
    type: java_web
    runtime: java7
mem: 1024M</code></pre>

<h3 id='back_to_performance_improvements'>Back to performance Improvements</h3>

<p>How much faster is Java 7 anyway? I could ask around (google might know) but instead I&#8217;ll try to find a simple benchmark to run on both.</p>

<p>A quick search rewarded me with a simple Java <a href='http://math.nist.gov/scimark2/'>benchmark</a> that should further the quest. This code is simple to understand (at a high level anyway), and is trivial to wrap into a class, which I&#8217;ll call <strong>JavaBench</strong>.</p>

<p>I simply added a few lines to my basic servlet that invoke JavaBench.bench() and print the result.</p>

<p>Then it&#8217;s a simple matter of building the app and pushing to the Stackato cluster.</p>

<p>Using maven the steps are:</p>

<ul>
<li>
<p>mvn clean package</p>
</li>

<li>
<p>add the stackato.yml file from above</p>

<p>name: benchmark-java6 framework: type: java_web runtime: java6 mem: 1024M</p>
</li>

<li>
<p>stackato push -n</p>
</li>
</ul>

<p>Wait for the deploy to complete, and note the URL that&#8217;s displayed. Visiting this in a browser results in a page that shows the benchmark results as well as the Java version.</p>

<h3 id='that_was_java_6_now_try_java_7'>That was Java 6, now try Java 7</h3>

<p>I want to deploy both apps into a single Stackato cluster, which can be easily accomplished by changing the name and the runtime in the stackato.yml file and redeploying:</p>

<pre><code># updated stackato.yml
name:   benchmark-java7
framework:
    type: java_web
    runtime: java7
mem: 1024M


$ stackato push -n</code></pre>

<p>Now both apps are shown in the output of &#8220;stackato apps&#8221;:</p>

<pre><code>$ stackato apps

+-------------+---+---------+---------------------------------+----------+
| Application | # | Health  | URLS                            | Services |
+----------------+----------+---------------------------------+----------+
| bench-java6 | 1 | RUNNING | bench-java6.stackato-d6jy.local |          |
| bench-java7 | 1 | RUNNING | bench-java7.stackato-d6jy.local |          |
+-------------+---+---------+---------------------------------+----------+</code></pre>

<p>Now visit the <a href='j7.stackato-d6jy.local'>j7.stackato-d6jy.local</a> and observe the results.</p>

<p>Well what do you know - Java 7 <strong>is</strong> faster. (At least it&#8217;s faster according to this limited numerically intensive benchmark &#8211; your mileage will vary).</p>

<h4 id='other_frameworks'>Other Frameworks</h4>

<p>By the same procedure (adding a runtime directive to stackato.yml) applications built with the Spring, Play, Java_EE, and Grails can also run with Java 7 SE.</p>

<h4 id='summary'>Summary</h4>

<p>This was is a long-winded way of saying that Stackato now supports Java 7. Java 7 and Java 6 applications</p>

    <hr>
    <hr>
    
  </div>

      </div>


      <footer>
        <p>&copy; John Wetherill 2012 </p>
<!--          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
          and <a href="https://github.com/isagalaev/highlight.js" target="_blank">Highlight.js</a>
        </p>-->
      </footer>

    </div> <!-- /container -->

    
  </body>
</html>


